<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
<meta HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="-1">
<title>Tetris</title>
<script src="lib/cytoscape.umd.js"></script>
<script src="lib/dagre.min.js"></script>
<script src="lib/cytoscape-dagre.js"></script>
<script src="lib/racytoscal.js"></script>
<script>
z0  = 99999999;
cnt = 0;
n  = 20;
function extraMark(s){
	if (s.length==0) return "";
	   var el = document.getElementById(""+z0+"cells"); 
	   if (el!=null) {
		     el.style["background-color"] = oldColor;
		     el.style["opacity"] = "1";
	   }
	   var t = JSON.parse(s);
	   if  (t.path=="reset" || t.path=="fall") {
		   z0  = 99999999; 
		   return "";
	   }
	   var x = parseInt(t.x);
	   var y = Math.floor(z0/20);  
	   var z = y*20+x;
	   el = document.getElementById(""+z+"cells"); 
	   if (el!=null) {
		    oldColor = el.style["background-color"];
		    el.style["background-color"] = "yellow";
		    el.style["opacity"] = "0.5";
	        }
	   z0 = z;
	   return "";
    }

function clickCallback(s) {
	  // cnt = 1;
	  return extraMark(fromRascal(s));
}

function fromRascal1(s) {
	var t = JSON.parse(fromRascal(s));
	var x = parseInt(t.x);
	var y = parseInt(t.y)+4; 
	z0 = 20*8+x;
	return s;
}

oldColor = "white";
function timerCallback(s) {
	var el = document.getElementById(""+z0+"cells");
	if (el!=null) {
		 el.style["background-color"] = oldColor;
		 el.style["opacity"] = "1";
	}	
	//alert(z0);
	if (z0>20*40) {
		 httpGet(fromRascal1, "timer/"+cnt, false);cnt=1;	 
	 }
	z = z0+20;
	el = document.getElementById(""+z+"cells"); 
	if (el!=null) {
		  oldColor = el.style["background-color"];
		  el.style["background-color"] = "yellow";
	      el.style["opacity"] = "0.5";
	}
	z0 = z;
	cnt=cnt+1;
	// return "";
}




// window.addEventListener("click", extraMark);
</script>
<style>
.cells {
    width: 20px; height: 20px;
    border: 1px solid powderblue;  
    background-color:antiquewhite; 
    }
/* #cells_3_0 {background-color:red} */
#table {
    border: 2px solid grey;
    border-collapse:collapse;
    }
title {display:block}
</style>
</head>
<body onbeforeunload="handleOnClose()">
<h1>Tetris</h1>
<div id='attach'>
</div>
<table>
<tr>
<td id = "T"></td>
<td id = "I"></td>
<td id = "Z"></td>
<td id = "L"></td>
<td id = "L1"></td>
<td id = "O"></td>
<td>
<button id ="rotate">Rotate</button>
</td>
<td>
<button id ="left">Left</button>
</td>
<td>
<button id ="right">Right</button>
</td>
<td>
<button id ="up">Up</button>
</td>
<td>
<button id ="down">Down</button>
</td>
<td>
<button id ="fall">Fall</button>
</td>
<td>
<button id ="reset">Reset</button>
</td>
</tr>
</table>
</body>
</html>